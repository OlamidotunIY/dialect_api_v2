model Workspace {
    id                     String           @id @default(auto()) @map("_id") @db.ObjectId
    name                   String
    description            String?
    ownerId                String           @db.ObjectId
    teamSize               Int?
    defaultStreamId        Int?
    inviteLink             String?          @unique
    inviteLinkActive       Boolean          @default(true)
    logo                   String?
    subscriptionPlan       SubscriptionPlan @default(FREE)
    subscriptionExpiryDate DateTime?
    aiEnabled              Boolean          @default(false)
    stripeCustomerId       String?
    stripeSubscriptionId   String?
    subscriptiontrialEnd   DateTime?
    createdAt              DateTime         @default(now())
    updatedAt              DateTime         @updatedAt
    defaultRoleId          String?          @db.ObjectId

    // Relations
    owner           User              @relation("OwnedWorkspaces", fields: [ownerId], references: [id])
    members         WorkspaceMember[] // Implicit many-to-many relation via WorkspaceMember
    streams         Stream[]
    roles           Role[]
    WorkspaceInvite WorkspaceInvite[]
    Activities        Activity[]

    // Constraints
    @@unique([ownerId, name]) // Ensure name is unique within a user's workspaces
    // Indexes
    @@index([ownerId])
}

model WorkspaceMember {
    id          String                @id @default(auto()) @map("_id") @db.ObjectId
    userId      String                @db.ObjectId
    workspaceId String                @db.ObjectId
    roleId      String                @db.ObjectId
    status      WorkspaceMemberStatus @default(PENDING)

    // Relations
    user      User      @relation(fields: [userId], references: [id])
    workspace Workspace @relation(fields: [workspaceId], references: [id])
    role      Role      @relation(fields: [roleId], references: [id])

    // Constraints
    @@unique([userId, workspaceId]) // Ensure a user can only be a member of a workspace once
    // Indexes
    @@index([userId])
    @@index([workspaceId])
    @@index([roleId])
}

model WorkspaceInvite {
    id          String   @id @default(auto()) @map("_id") @db.ObjectId
    email       String   @unique // Email address of the invitee
    workspaceId String   @db.ObjectId
    token       String   @unique // Secure invite token
    expiresAt   DateTime // Expiration date of the invite
    status      String   @default("pending") // "pending", "accepted", "expired"

    workspace Workspace @relation(fields: [workspaceId], references: [id])
}

enum WorkspaceMemberStatus {
    PENDING
    ACTIVE
    INACTIVE
}
