model Task {
    id          String    @id @default(auto()) @map("_id") @db.ObjectId
    name        String
    description String?
    projectId   String    @db.ObjectId
    status      String    @default("Not Started")
    dueDate     DateTime?
    priority    String    @default("Low")
    createdAt   DateTime  @default(now())
    updatedAt   DateTime  @updatedAt

    // Relations
    project        Project          @relation(fields: [projectId], references: [id])
    assignedUsers  TaskAssignment[]
    dependencies   Dependency[]
    dependents     Dependency[]     @relation("Dependents")
    checklistItems ChecklistItem[]
    subtasks       Task[]           @relation("Subtasks")
    parent         Task?            @relation("Subtasks", fields: [parentId], references: [id], onDelete: NoAction, onUpdate: NoAction)
    parentId       String?          @db.ObjectId

    // Indexes
    @@index([projectId])
}

model Dependency {
    id        String @id @default(auto()) @map("_id") @db.ObjectId
    taskId    String @db.ObjectId
    dependsOn String @db.ObjectId

    // Relations
    task          Task @relation(fields: [taskId], references: [id])
    dependsOnTask Task @relation("Dependents", fields: [dependsOn], references: [id])
}

model TaskAssignment {
    id     String @id @default(auto()) @map("_id") @db.ObjectId
    taskId String @db.ObjectId
    userId String @db.ObjectId

    // Relations
    task Task @relation(fields: [taskId], references: [id])
    user User @relation(fields: [userId], references: [id])

    @@unique([taskId, userId])
}

model ChecklistItem {
    id      String  @id @default(auto()) @map("_id") @db.ObjectId
    taskId  String  @db.ObjectId
    content String
    isDone  Boolean @default(false)

    // Relations
    task Task @relation(fields: [taskId], references: [id])
}
